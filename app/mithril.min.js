Mithril=m=new function e(t,n){function u(){var e=Array.prototype.slice.call(arguments,0);var t=e[1]!=null&&r.call(e[1])=="[object Object]"&&!("tag"in e[1])&&!("subtree"in e[1]);var n=t?e[1]:{};var o="class"in n?"class":"className";var u={tag:"div",attrs:{}};var a,f=[];while(a=i.exec(e[0])){if(a[1]=="")u.tag=a[2];else if(a[1]=="#")u.attrs.id=a[2];else if(a[1]==".")f.push(a[2]);else if(a[3][0]=="["){var l=s.exec(a[3]);u.attrs[l[1]]=l[3]||(l[2]?"":true)}}if(f.length>0)u.attrs[o]=f.join(" ");var c=t?e[2]:e[1];if(c instanceof Array){u.children=c}else{u.children=t?e.slice(2):e.slice(1)}for(var h in n){if(h==o)u.attrs[h]=(u.attrs[h]||"")+" "+n[h];else u.attrs[h]=n[h]}return u}function a(e,i,s,u,c,d,v,m,g,y,b){if(c==null)c="";if(c.subtree==="retain")return d;var w=r.call(d),E=r.call(c);if(d==null||w!=E){if(d!=null){if(s&&s.nodes){var S=m-u;var x=S+(E=="[object Array]"?c:d.nodes).length;l(s.nodes.slice(S,x),s.slice(S,x))}else if(d.nodes)l(d.nodes,d)}d=new c.constructor;d.nodes=[]}if(E=="[object Array]"){c=p(c);var T=[],N=d.length===c.length,C=0;var k=1,L=2,A=3;var O={},M=[],_=false;for(var D=0;D<d.length;D++){if(d[D]&&d[D].attrs&&d[D].attrs.key!=null){_=true;O[d[D].attrs.key]={action:k,index:D}}}if(_){for(var D=0;D<c.length;D++){if(c[D]&&c[D].attrs){if(c[D].attrs.key!=null){var P=c[D].attrs.key;if(!O[P])O[P]={action:L,index:D};else O[P]={action:A,index:D,from:O[P].index,element:e.childNodes[O[P].index]}}else M.push({index:D,element:e.childNodes[D]||t.document.createElement("dummy")})}}var H=Object.keys(O).map(function(e){return O[e]});var B=H.sort(function(e,t){return e.action-t.action||e.index-t.index});var j=d.slice();for(var D=0,F;F=B[D];D++){if(F.action==k){l(d[F.index].nodes,d[F.index]);j.splice(F.index,1)}if(F.action==L){var I=t.document.createElement("dummy2");I.key=c[F.index].attrs.key;e.insertBefore(I,e.childNodes[F.index]);j.splice(F.index,0,{attrs:{key:c[F.index].attrs.key},nodes:[I]})}if(F.action==A){if(e.childNodes[F.index]!==F.element&&F.element!==null){e.insertBefore(F.element,e.childNodes[F.index])}j[F.index]=d[F.from]}}for(var D=0;D<M.length;D++){var F=M[D];e.insertBefore(F.element,e.childNodes[F.index]);j[F.index]=d[F.index]}d=j;d.nodes=[];for(var D=0,q;q=e.childNodes[D];D++)d.nodes.push(q)}for(var D=0,R=0;D<c.length;D++){var U=a(e,i,d,m,c[D],d[R],v,m+C||C,g,y,b);if(U===n)continue;if(!U.nodes.intact)N=false;var z=r.call(U)=="[object Array]";C+=z?U.length:1;d[R++]=U}if(!N){for(var D=0;D<c.length;D++){if(d[D]!=null)T=T.concat(d[D].nodes)}for(var D=0,W;W=d.nodes[D];D++){if(W.parentNode!=null&&T.indexOf(W)<0)l([W],[d[D]])}for(var D=d.nodes.length,W;W=T[D];D++){if(W.parentNode==null)e.appendChild(W)}if(c.length<d.length)d.length=c.length;d.nodes=T}}else if(c!=null&&E=="[object Object]"){if(c.tag!=d.tag||Object.keys(c.attrs).join()!=Object.keys(d.attrs).join()||c.attrs.id!=d.attrs.id){l(d.nodes);if(d.configContext&&typeof d.configContext.onunload=="function")d.configContext.onunload()}if(typeof c.tag!="string")return;var W,X=d.nodes.length===0;if(c.attrs.xmlns)y=c.attrs.xmlns;else if(c.tag==="svg")y="http://www.w3.org/2000/svg";else if(c.tag==="math")y="http://www.w3.org/1998/Math/MathML";if(X){W=y===n?t.document.createElement(c.tag):t.document.createElementNS(y,c.tag);d={tag:c.tag,children:a(W,c.tag,n,n,c.children,d.children,true,0,c.attrs.contenteditable?W:g,y,b),attrs:f(W,c.tag,c.attrs,{},y),nodes:[W]};e.insertBefore(W,e.childNodes[m]||null)}else{W=d.nodes[0];f(W,c.tag,c.attrs,d.attrs,y);d.children=a(W,c.tag,n,n,c.children,d.children,false,0,c.attrs.contenteditable?W:g,y,b);d.nodes.intact=true;if(v===true&&W!=null)e.insertBefore(W,e.childNodes[m]||null)}if(typeof c.attrs["config"]==="function"){var V=d.configContext=d.configContext||{};var $=function(e,t){return function(){return e.attrs["config"].apply(e,t)}};b.push($(c,[W,!X,V,d]))}}else if(typeof E!="function"){var T;if(d.nodes.length===0){if(c.$trusted){T=h(e,m,c)}else{T=[t.document.createTextNode(c)];if(!e.nodeName.match(o))e.insertBefore(T[0],e.childNodes[m]||null)}d="string number boolean".indexOf(typeof c)>-1?new c.constructor(c):c;d.nodes=T}else if(d.valueOf()!==c.valueOf()||v===true){T=d.nodes;if(!g||g!==t.document.activeElement){if(c.$trusted){l(T,d);T=h(e,m,c)}else{if(i==="textarea")e.value=c;else if(g)g.innerHTML=c;else{if(T[0].nodeType==1||T.length>1){l(d.nodes,d);T=[t.document.createTextNode(c)]}e.insertBefore(T[0],e.childNodes[m]||null);T[0].nodeValue=c}}}d=new c.constructor(c);d.nodes=T}else d.nodes.intact=true}return d}function f(e,n,r,i,s){for(var o in r){var u=r[o];var a=i[o];if(!(o in i)||a!==u||e===t.document.activeElement){i[o]=u;try{if(o==="config")continue;else if(typeof u=="function"&&o.indexOf("on")==0){e[o]=d(u,e)}else if(o==="style"&&typeof u=="object"){for(var f in u){if(a==null||a[f]!==u[f])e.style[f]=u[f]}for(var f in a){if(!(f in u))e.style[f]=""}}else if(s!=null){if(o==="href")e.setAttributeNS("http://www.w3.org/1999/xlink","href",u);else if(o==="className")e.setAttribute("class",u);else e.setAttribute(o,u)}else if(o==="value"&&n==="input"){if(e.value!==u)e.value=u}else if(o in e&&!(o=="list"||o=="style"||o=="form")){e[o]=u}else e.setAttribute(o,u)}catch(l){if(l.message.indexOf("Invalid argument")<0)throw l}}}return i}function l(e,t){for(var n=e.length-1;n>-1;n--){if(e[n]&&e[n].parentNode){e[n].parentNode.removeChild(e[n]);t=[].concat(t);if(t[n])c(t[n])}}if(e.length!=0)e.length=0}function c(e){if(e.configContext&&typeof e.configContext.onunload=="function")e.configContext.onunload();if(e.children){if(r.call(e.children)=="[object Array]"){for(var t=0;t<e.children.length;t++)c(e.children[t])}else if(e.children.tag)c(e.children)}}function h(e,n,r){var i=e.childNodes[n];if(i){var s=i.nodeType!=1;var o=t.document.createElement("span");if(s){e.insertBefore(o,i);o.insertAdjacentHTML("beforebegin",r);e.removeChild(o)}else i.insertAdjacentHTML("beforebegin",r)}else e.insertAdjacentHTML("beforeend",r);var u=[];while(e.childNodes[n]!==i){u.push(e.childNodes[n]);n++}return u}function p(e){var t=[];for(var n=0;n<e.length;n++){var i=e[n];if(r.call(i)=="[object Array]")t.push.apply(t,p(i));else t.push(i)}return t}function d(e,t,n){return function(n){n=n||event;u.redraw.strategy("diff");u.startComputation();try{return e.call(t,n)}finally{if(!T)T=-1;u.endComputation()}}}function b(e){var t=g.indexOf(e);return t<0?g.push(e)-1:t}function w(e){var t=function(){if(arguments.length)e=arguments[0];return e};t.toJSON=function(){return e};return t}function k(){var e=u.redraw.strategy();for(var t=0;t<E.length;t++){if(x[t]&&e!="none")u.render(E[t],S[t].view(x[t]),e=="all")}if(N){N();N=null}T=null;u.redraw.strategy("diff")}function D(e){return e.slice(A[u.route.mode].length)}function P(e,t,n){M={};var r=n.indexOf("?");if(r!==-1){M=F(n.substr(r+1,n.length));n=n.substr(0,r)}for(var i in t){if(i==n){u.module(e,t[i]);return true}var s=new RegExp("^"+i.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(n)){n.replace(s,function(){var n=i.match(/:[^\/]+/g)||[];var r=[].slice.call(arguments,1,-2);for(var s=0;s<n.length;s++)M[n[s].replace(/:|\./g,"")]=decodeURIComponent(r[s]);u.module(e,t[i])});return true}}}function H(e){e=e||event;if(e.ctrlKey||e.metaKey||e.which==2)return;if(e.preventDefault)e.preventDefault();else e.returnValue=false;u.route(e.currentTarget[u.route.mode].slice(A[u.route.mode].length))}function B(){if(u.route.mode!="hash"&&t.location.hash)t.location.hash=t.location.hash;else t.scrollTo(0,0)}function j(e,t){var n=[];for(var r in e){var i=t?t+"["+r+"]":r,s=e[r];n.push(typeof s=="object"?j(s,i):encodeURIComponent(i)+"="+encodeURIComponent(s))}return n.join("&")}function F(e){var t=e.split("&"),n={};for(var r=0;r<t.length;r++){var i=t[r].split("=");n[I(i[0])]=i[1]?I(i[1]):i.length===1?true:""}return n}function I(e){return decodeURIComponent(e.replace(/\+/g," "))}function q(e){var t=b(e);l(e.childNodes,y[t]);y[t]=n}function R(e,t){e.then=function(){var e=u.prop();return R(e,t.then.apply(t,arguments).then(e))};e.promise=e;e.resolve=function(n){e(n);t=t.resolve.apply(t,arguments);return e};e.reject=function(){t=t.reject.apply(t,arguments);return e};return e}function U(e,t){function l(e){u=e||s;f.map(function(e){u==i&&e.resolve(a)||e.reject(a)})}function c(e,t,n,r){if((typeof a=="object"||typeof a=="function")&&typeof e=="function"){try{var i=0;e.call(a,function(e){if(i++)return;a=e;t()},function(e){if(i++)return;a=e;n()})}catch(s){a=s;n()}}else{r()}}function h(){var s;try{s=a&&a.then}catch(f){a=f;u=r;return h()}c(s,function(){u=n;h()},function(){u=r;h()},function(){try{if(u==n&&typeof e=="function"){a=e(a)}else if(u==r&&typeof t=="function"){a=t(a);u=n}}catch(f){a=f;return l()}if(a==o){a=TypeError();l()}else{c(s,function(){l(i)},l,function(){l(u==n&&i)})}})}var n=1,r=2,i=3,s=4;var o=this,u=0,a=0,f=[];o["promise"]=o;o["resolve"]=function(e){if(!u){a=e;u=n;h()}return this};o["reject"]=function(e){if(!u){a=e;u=r;h()}return this};o["then"]=function(e,t){var n=new U(e,t);if(u==i){n.resolve(a)}else if(u==s){n.reject(a)}else{f.push(n)}return n}}function z(e){return e}function W(e){if(e.dataType&&e.dataType.toLowerCase()==="jsonp"){var n="mithril_callback_"+(new Date).getTime()+"_"+Math.round(Math.random()*1e16).toString(36);var r=t.document.createElement("script");t[n]=function(i){delete t[n];t.document.body.removeChild(r);e.onload({type:"load",target:{responseText:i}})};r.onerror=function(i){delete t[n];t.document.body.removeChild(r);e.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}});return false};r.onload=function(e){return false};r.src=e.url+(e.url.indexOf("?")>0?"&":"?")+(e.callbackKey?e.callbackKey:"callback")+"="+n+"&"+j(e.data||{});t.document.body.appendChild(r)}else{var i=new t.XMLHttpRequest;i.open(e.method,e.url,true,e.user,e.password);i.onreadystatechange=function(){if(i.readyState===4){if(i.status>=200&&i.status<300)e.onload({type:"load",target:i});else e.onerror({type:"error",target:i})}};if(e.serialize==JSON.stringify&&e.method!="GET"){i.setRequestHeader("Content-Type","application/json; charset=utf-8")}if(typeof e.config=="function"){var s=e.config(i,e);if(s!=null)i=s}i.send(e.method=="GET"?"":e.data);return i}}function X(e,t,n){if(t&&Object.keys(t).length>0){if(e.method=="GET"){e.url=e.url+(e.url.indexOf("?")<0?"?":"&")+j(t)}else e.data=n(t)}return e}function V(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t){for(var r=0;r<n.length;r++){var i=n[r].slice(1);e=e.replace(n[r],t[i]);delete t[i]}}return e}var r={}.toString;var i=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,s=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/;var o=/AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TR‌​ACK|WBR/;var v;var m={insertAdjacentHTML:function(e,n){t.document.write(n);t.document.close()},appendChild:function(e){if(v===n)v=t.document.createElement("html");if(e.nodeName=="HTML")v=e;else v.appendChild(e);if(t.document.documentElement&&t.document.documentElement!==v){t.document.replaceChild(v,t.document.documentElement)}else t.document.appendChild(v)},insertBefore:function(e){this.appendChild(e)},childNodes:[]};var g=[],y={};u.render=function(e,r,i){var s=[];if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var o=b(e);var u=e==t.document||e==t.document.documentElement?m:e;if(y[o]===n)l(u.childNodes);if(i===true)q(e);y[o]=a(u,null,n,n,r,y[o],false,0,null,n,s);for(var f=0;f<s.length;f++)s[f]()};u.trust=function(e){e=new String(e);e.$trusted=true;return e};u.prop=function(e){if((typeof e==="object"||typeof e==="function")&&e!==null&&typeof e.then==="function"){var t=w();R(t,e).then(t);return t}return w(e)};var E=[],S=[],x=[],T=0,N=null,C=false;u.module=function(e,t){var n=E.indexOf(e);if(n<0)n=E.length;var r=false;if(x[n]&&typeof x[n].onunload=="function"){var i={preventDefault:function(){r=true}};x[n].onunload(i)}if(!r){u.redraw.strategy("all");u.startComputation();E[n]=e;S[n]=t;x[n]=new t.controller;u.endComputation();return x[n]}};u.redraw=function(e){var n=t.cancelAnimationFrame||t.clearTimeout;var r=t.requestAnimationFrame||t.setTimeout;if(T&&e!==true){n(T);T=r(k,0)}else{k();T=r(function(){T=null},0)}};u.redraw.strategy=u.prop();var L=0;u.startComputation=function(){L++};u.endComputation=function(){L=Math.max(L-1,0);if(L==0)u.redraw()};u.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var A={pathname:"",hash:"#",search:"?"};var O=function(){},M={},_;u.route=function(){if(arguments.length===0)return _;else if(arguments.length===3&&typeof arguments[1]=="string"){var e=arguments[0],n=arguments[1],r=arguments[2];O=function(t){var i=_=D(t);if(!P(e,r,i)){u.route(n,true)}};var i=u.route.mode=="hash"?"onhashchange":"onpopstate";t[i]=function(){if(_!=D(t.location[u.route.mode])){O(t.location[u.route.mode])}};N=B;t[i]()}else if(arguments[0].addEventListener){var s=arguments[0];var o=arguments[1];if(s.href.indexOf(A[u.route.mode])<0){s.href=t.location.pathname+A[u.route.mode]+s.pathname}if(!o){s.removeEventListener("click",H);s.addEventListener("click",H)}}else if(typeof arguments[0]=="string"){_=arguments[0];var a=typeof arguments[1]=="object"?j(arguments[1]):null;if(a)_+=(_.indexOf("?")===-1?"?":"&")+a;var f=(arguments.length==3?arguments[2]:arguments[1])===true;if(t.history.pushState){N=function(){t.history[f?"replaceState":"pushState"](null,t.document.title,A[u.route.mode]+_);B()};O(A[u.route.mode]+_)}else t.location[u.route.mode]=_}};u.route.param=function(e){return M[e]};u.route.mode="search";u.deferred=function(){return R(u.prop(),new U)};u.sync=function(e){function n(e,n){return function(o){s[e]=o;if(!n)t="reject";if(--i==0){r.promise(s);r[t](s)}return o}}var t="resolve";var r=u.deferred();var i=e.length;var s=new Array(i);if(e.length>0){for(var o=0;o<e.length;o++){e[o].then(n(o,true),n(o,false))}}else r.resolve();return r.promise};u.request=function(e){if(e.background!==true)u.startComputation();var t=u.deferred();var n=e.dataType&&e.dataType.toLowerCase()==="jsonp";var i=e.serialize=n?z:e.serialize||JSON.stringify;var s=e.deserialize=n?z:e.deserialize||JSON.parse;var o=e.extract||function(e){return e.responseText.length===0&&s===JSON.parse?null:e.responseText};e.url=V(e.url,e.data);e=X(e,e.data,i);e.onload=e.onerror=function(n){try{n=n||event;var i=(n.type=="load"?e.unwrapSuccess:e.unwrapError)||z;var a=i(s(o(n.target,e)));if(n.type=="load"){if(r.call(a)=="[object Array]"&&e.type){for(var f=0;f<a.length;f++)a[f]=new e.type(a[f])}else if(e.type)a=new e.type(a)}t[n.type=="load"?"resolve":"reject"](a)}catch(n){if(n instanceof SyntaxError)throw new SyntaxError("Could not parse HTTP response. See http://lhorie.github.io/mithril/mithril.request.html#using-variable-data-formats");else if(r.call(n)=="[object Error]"&&n.constructor!==Error)throw n;else t.reject(n)}if(e.background!==true)u.endComputation()};W(e);return t.promise};u.deps=function(e){return t=e};u.deps.factory=e;return u}(typeof window!="undefined"?window:{});if(typeof module!="undefined"&&module!==null)module.exports=m;if(typeof define=="function"&&define.amd)define(function(){return m});